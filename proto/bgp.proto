syntax = "proto3";

package bgp;

// ============================================================================
// BGP Service
// ============================================================================
service BgpService {
    rpc AddPeer(AddPeerRequest) returns (AddPeerResponse);
    rpc RemovePeer(RemovePeerRequest) returns (RemovePeerResponse);
    rpc GetPeers(GetPeersRequest) returns (GetPeersResponse);
    rpc GetPeer(GetPeerRequest) returns (GetPeerResponse);
    rpc AddRoute(AddRouteRequest) returns (AddRouteResponse);
    rpc WithdrawRoute(WithdrawRouteRequest) returns (WithdrawRouteResponse);
    rpc GetRoutes(GetRoutesRequest) returns (GetRoutesResponse);
}

// Add peer request/response
message AddPeerRequest {
    string address = 1;  // IP:PORT format (e.g., "192.168.1.1:179")
}

message AddPeerResponse {
    bool success = 1;
    string message = 2;
}

// Remove peer request/response
message RemovePeerRequest {
    string address = 1;
}

message RemovePeerResponse {
    bool success = 1;
    string message = 2;
}

// Get peers request/response
message GetPeersRequest {}

message GetPeersResponse {
    repeated Peer peers = 1;
}

// Get peer request/response
message GetPeerRequest {
    string address = 1;  // Peer IP address
}

message GetPeerResponse {
    Peer peer = 1;
    PeerStatistics statistics = 2;
}

// Peer statistics
message PeerStatistics {
    uint64 open_sent = 1;
    uint64 keepalive_sent = 2;
    uint64 update_sent = 3;
    uint64 notification_sent = 4;
    uint64 open_received = 5;
    uint64 keepalive_received = 6;
    uint64 update_received = 7;
    uint64 notification_received = 8;
}

// BGP FSM states
enum BgpState {
    IDLE = 0;
    CONNECT = 1;
    ACTIVE = 2;
    OPEN_SENT = 3;
    OPEN_CONFIRM = 4;
    ESTABLISHED = 5;
}

// Peer information
message Peer {
    string address = 1;
    uint32 asn = 2;
    BgpState state = 3;
}

// Add route request/response
message AddRouteRequest {
    string prefix = 1;      // CIDR format (e.g., "10.0.0.0/24")
    string next_hop = 2;    // IPv4 address (e.g., "192.168.1.1")
    Origin origin = 3;      // Route origin
    repeated AsPathSegment as_path = 4; // Optional AS_PATH (empty = locally originated)
}

message AddRouteResponse {
    bool success = 1;
    string message = 2;
}

// Withdraw route request/response
message WithdrawRouteRequest {
    string prefix = 1;      // CIDR format (e.g., "10.0.0.0/24")
}

message WithdrawRouteResponse {
    bool success = 1;
    string message = 2;
}

// BGP Origin attribute
enum Origin {
    IGP = 0;
    EGP = 1;
    INCOMPLETE = 2;
}

// AS_PATH segment type
enum AsPathSegmentType {
    AS_SET = 0;
    AS_SEQUENCE = 1;
}

// AS_PATH segment
message AsPathSegment {
    AsPathSegmentType segment_type = 1;
    repeated uint32 asns = 2;
}

// Get routes request/response
message GetRoutesRequest {}

message GetRoutesResponse {
    repeated Route routes = 1;
}

// Route information
message Route {
    string prefix = 1;      // CIDR format
    repeated Path paths = 2; // Multiple paths to same prefix
}

// Path information
message Path {
    Origin origin = 1;
    repeated AsPathSegment as_path = 2;
    string next_hop = 3;
    string peer_address = 4;
    optional uint32 local_pref = 5;
    optional uint32 med = 6;
}
